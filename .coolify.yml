# Coolify Configuration for Storage Boxx PHP Inventory Management System
# This file tells Coolify how to deploy this application

# FORCE Docker Compose deployment - do not auto-detect
type: docker-compose
build_pack: docker-compose

# Use the Coolify-optimized docker-compose file
docker_compose_file: docker-compose.yaml

# Main service that should receive traffic
main_service: app

# Port mapping - PHP-FPM for Coolify's reverse proxy
ports:
  - target: 9000
    published: 9000
    protocol: tcp

# Health check endpoint - Check PHP-FPM status
healthcheck:
  test: ["CMD", "php-fpm", "-t"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 40s

# Environment variables (these will be set in Coolify UI)
environment:
  - APP_ENV=production
  - APP_DEBUG=false
  - APP_URL=https://inventory.thesupplycircuit.co

# Domain configuration
domains:
  - inventory.thesupplycircuit.co

# SSL/TLS configuration
ssl: true

# Build configuration - FORCE Docker Compose
build:
  # Use Docker Compose for building - ignore auto-detection
  dockerfile: Dockerfile
  context: .
  build_pack: docker-compose
  
# Disable auto-detection
auto_deploy: false
static_site: false

# Restart policy
restart: unless-stopped

# Labels for Coolify management
labels:
  - "coolify.managed=true"
  - "coolify.type=docker-compose"
  - "coolify.name=storage-boxx"